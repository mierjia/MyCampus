{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapState, mapActions } from 'vuex';\nexport default {\n  name: 'comment',\n  computed: {\n    ...mapState({\n      uinfo: state => state.user.uinfo\n    })\n  },\n  data() {\n    return {\n      loading: false,\n      pagelistquery: {\n        admin: '',\n        state: '',\n        total: 0,\n        page: 1,\n        pagesize: 10\n      },\n      tableData: []\n    };\n  },\n  methods: {\n    async getreply() {\n      for (let index = 0; index < this.tableData.length; index++) {\n        let res = await this.$axios.post('/admin/getreply', this.qs.stringify({\n          comment_id: this.tableData[index].comment_id\n        }));\n        if (res.data.state.type === 'SUCCESS') {\n          this.tableData[index].child = res.data.data;\n        }\n      }\n    },\n    async changestate(type, state, id) {\n      let data = {\n        id: id,\n        type: type,\n        state: state\n      };\n      let res = await this.$axios.post('/admin/changecontentstate', this.qs.stringify(data));\n      if (res.data.state.type === 'SUCCESS') {\n        this.$message.success('操作成功');\n        this.getcommentlist();\n        this.dialog = false;\n      }\n    },\n    handleSizeChange(val) {\n      this.pagelistquery.pagesize = val;\n      this.getcommentlist();\n    },\n    handleCurrentChange(val) {\n      this.pagelistquery.page = val;\n      this.getcommentlist();\n    },\n    async del(id, type) {\n      let data = {\n        id: id,\n        type: type\n      };\n      this.$confirm('确认删除吗?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        this.$axios.post('/admin/admindelete', this.qs.stringify(data)).then(res => {\n          if (res.data.state.type === 'SUCCESS') {\n            this.$message.success('删除成功');\n            this.getcommentlist();\n          }\n        });\n      });\n    },\n    async getcommentlist() {\n      this.loading = true;\n      let res = await this.$axios.post('/admin/getcomment', this.qs.stringify(this.pagelistquery));\n      if (res.data.state.type === 'SUCCESS') {\n        this.tableData = res.data.data;\n        this.pagelistquery.total = res.data.count;\n        this.getreply();\n      }\n      this.loading = false;\n    }\n  },\n  created() {\n    this.getcommentlist();\n  }\n};","map":{"version":3,"names":["mapState","mapActions","name","computed","uinfo","state","user","data","loading","pagelistquery","admin","total","page","pagesize","tableData","methods","getreply","index","length","res","$axios","post","qs","stringify","comment_id","type","child","changestate","id","$message","success","getcommentlist","dialog","handleSizeChange","val","handleCurrentChange","del","$confirm","confirmButtonText","cancelButtonText","then","count","created"],"sources":["src/views/check/comment.vue"],"sourcesContent":["<template>\n  <div class=\"comment\">\n    <el-main>\n      <div class=\"top\">\n        <el-breadcrumb separator=\"/\">\n          <el-breadcrumb-item :to=\"{ path: '/' }\">首页</el-breadcrumb-item>\n          <el-breadcrumb-item>审核中心</el-breadcrumb-item>\n          <el-breadcrumb-item>评论审核</el-breadcrumb-item>\n        </el-breadcrumb>\n      </div>\n\n      <div class=\"main\">\n        <div class=\"search\">\n          <el-form\n            :inline=\"true\"\n            :model=\"pagelistquery\"\n            class=\"demo-form-inline\"\n          >\n            <el-form-item>\n              <el-input\n                v-model=\"pagelistquery.admin\"\n                placeholder=\"审批人\"\n              ></el-input>\n            </el-form-item>\n            <el-form-item>\n              <el-select v-model=\"pagelistquery.state\" placeholder=\"状态\">\n                <el-option label=\"全部\" value></el-option>\n                <el-option label=\"待审核\" value=\"0\"></el-option>\n                <el-option label=\"审核通过\" value=\"1\"></el-option>\n\n                <el-option label=\"审核未通过\" value=\"-1\"></el-option>\n              </el-select>\n            </el-form-item>\n\n            <el-form-item>\n              <el-button type=\"primary\" @click=\"getcommentlist\">查询</el-button>\n            </el-form-item>\n          </el-form>\n        </div>\n\n        <el-table\n          :data=\"tableData\"\n          border\n          style=\"width: 100%;min-height:500px\"\n          v-loading=\"loading\"\n          element-loading-text=\"拼命加载中\"\n          element-loading-spinner=\"el-icon-loading\"\n        >\n          <!-- @expand-change=\"getreply\" -->\n          <el-table-column type=\"expand\">\n            <template slot-scope=\"props\">\n              <el-table :data=\"props.row.child\" style=\"width: 100%\">\n                <el-table-column type=\"index\" width=\"50\"></el-table-column>\n                <el-table-column prop=\"createtime\" label=\"创建日期\">\n                  <template slot-scope=\"scope\">{{\n                    scope.row.comment_createtime | dataFormat\n                  }}</template>\n                </el-table-column>\n                <el-table-column\n                  label=\"回复者\"\n                  prop=\"nickname\"\n                ></el-table-column>\n                <el-table-column\n                  label=\"被回复者\"\n                  prop=\"tousernickname\"\n                ></el-table-column>\n                <el-table-column label=\"状态\" prop=\"comment_ispublic\">\n                  <template slot-scope=\"scope\">\n                    <span style=\"color:#6cbb7a\" v-if=\"scope.row.ispublic == 1\"\n                      >审核通过</span\n                    >\n                    <span style=\"color:#409eff\" v-if=\"scope.row.ispublic == 0\"\n                      >未审核</span\n                    >\n                    <span style=\"color:#f60c6c\" v-if=\"scope.row.ispublic == -1\"\n                      >审核未通过</span\n                    >\n                  </template>\n                </el-table-column>\n                <el-table-column label=\"回复内容\" prop=\"desc\">\n                  <template slot-scope=\"scope\">\n                    <el-popover placement=\"right\" width=\"400\" trigger=\"hover\">\n                      <span v-html=\"scope.row.reply_content\"></span>\n                      <el-button type=\"text\" slot=\"reference\"\n                        >回复类容</el-button\n                      >\n                    </el-popover>\n                  </template>\n                </el-table-column>\n                <el-table-column label=\"审核人\" prop=\"admin\"></el-table-column>\n\n                <el-table-column fixed=\"right\" label=\"操作\" width=\"250\">\n                  <template slot-scope=\"scope\">\n                    <el-button\n                      type=\"text\"\n                      size=\"small\"\n                      v-if=\"scope.row.ispublic == 1\"\n                      @click=\"changestate('reply', -1, scope.row.reply_id)\"\n                      >不通过审核</el-button\n                    >\n                    <el-button\n                      type=\"text\"\n                      size=\"small\"\n                      v-if=\"scope.row.ispublic == 0\"\n                      @click=\"changestate('reply', 1, scope.row.reply_id)\"\n                      >通过审核</el-button\n                    >\n                    <el-button\n                      type=\"text\"\n                      size=\"small\"\n                      v-if=\"scope.row.ispublic == 0\"\n                      @click=\"changestate('reply', -1, scope.row.reply_id)\"\n                      >不通过审核</el-button\n                    >\n                    <el-button\n                      type=\"text\"\n                      size=\"small\"\n                      v-if=\"scope.row.ispublic == -1\"\n                      @click=\"changestate('reply', 1, scope.row.reply_id)\"\n                      >通过审核</el-button\n                    >\n                    <el-button\n                      type=\"text\"\n                      size=\"small\"\n                      @click=\"del(scope.row.reply_id, 'reply')\"\n                      :disabled=\"uinfo.username !== 'admin'\"\n                      >删除</el-button\n                    >\n                  </template>\n                </el-table-column>\n              </el-table>\n            </template>\n          </el-table-column>\n          <el-table-column prop=\"createtime\" label=\"创建日期\">\n            <template slot-scope=\"scope\">{{\n              scope.row.comment_createtime | dataFormat\n            }}</template>\n          </el-table-column>\n          <el-table-column label=\"评论者\" prop=\"nickname\"></el-table-column>\n          <el-table-column label=\"状态\" prop=\"comment_ispublic\">\n            <template slot-scope=\"scope\">\n              <span style=\"color:#6cbb7a\" v-if=\"scope.row.ispublic == 1\"\n                >审核通过</span\n              >\n              <span style=\"color:#409eff\" v-if=\"scope.row.ispublic == 0\"\n                >未审核</span\n              >\n              <span style=\"color:#f60c6c\" v-if=\"scope.row.ispublic == -1\"\n                >审核未通过</span\n              >\n            </template>\n          </el-table-column>\n          <el-table-column label=\"评论内容\" prop=\"desc\">\n            <template slot-scope=\"scope\">\n              <el-popover placement=\"right\" width=\"400\" trigger=\"hover\">\n                <span v-html=\"scope.row.comment_content\"></span>\n                <el-button type=\"text\" slot=\"reference\">评论类容</el-button>\n              </el-popover>\n            </template>\n          </el-table-column>\n          <el-table-column label=\"审核人\" prop=\"admin\"></el-table-column>\n\n          <el-table-column fixed=\"right\" label=\"操作\" width=\"250\">\n            <template slot-scope=\"scope\">\n              <el-button\n                type=\"text\"\n                size=\"small\"\n                v-if=\"scope.row.ispublic == 1\"\n                @click=\"changestate('comment', -1, scope.row.comment_id)\"\n                >不通过审核</el-button\n              >\n              <el-button\n                type=\"text\"\n                size=\"small\"\n                v-if=\"scope.row.ispublic == 0\"\n                @click=\"changestate('comment', 1, scope.row.comment_id)\"\n                >通过审核</el-button\n              >\n              <el-button\n                type=\"text\"\n                size=\"small\"\n                v-if=\"scope.row.ispublic == 0\"\n                @click=\"changestate('comment', -1, scope.row.comment_id)\"\n                >不通过审核</el-button\n              >\n              <el-button\n                type=\"text\"\n                size=\"small\"\n                v-if=\"scope.row.ispublic == -1\"\n                @click=\"changestate('comment', 1, scope.row.comment_id)\"\n                >通过审核</el-button\n              >\n              <el-button\n                type=\"text\"\n                size=\"small\"\n                @click=\"del(scope.row.comment_id, 'comment')\"\n                :disabled=\"uinfo.username !== 'admin'\"\n                >删除</el-button\n              >\n            </template>\n          </el-table-column>\n        </el-table>\n\n        <!--分页-->\n        <el-pagination\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n          :page-sizes=\"[10, 20, 50, 100]\"\n          :page-size=\"pagelistquery.pagesize\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          :total=\"pagelistquery.total\"\n          style=\"margin-top: 20px;\"\n        ></el-pagination>\n      </div>\n    </el-main>\n  </div>\n</template>\n\n<script>\nimport { mapState, mapActions } from 'vuex'\n\nexport default {\n  name: 'comment',\n  computed: {\n    ...mapState({\n      uinfo: state => state.user.uinfo\n    })\n  },\n  data() {\n    return {\n      loading: false,\n\n      pagelistquery: {\n        admin: '',\n        state: '',\n        total: 0,\n        page: 1,\n        pagesize: 10\n      },\n      tableData: []\n    }\n  },\n  methods: {\n    async getreply() {\n      for (let index = 0; index < this.tableData.length; index++) {\n        let res = await this.$axios.post(\n          '/admin/getreply',\n          this.qs.stringify({ comment_id: this.tableData[index].comment_id })\n        )\n        if (res.data.state.type === 'SUCCESS') {\n          this.tableData[index].child = res.data.data\n        }\n      }\n    },\n    async changestate(type, state, id) {\n      let data = {\n        id: id,\n        type: type,\n        state: state\n      }\n      let res = await this.$axios.post(\n        '/admin/changecontentstate',\n        this.qs.stringify(data)\n      )\n      if (res.data.state.type === 'SUCCESS') {\n        this.$message.success('操作成功')\n        this.getcommentlist()\n        this.dialog = false\n      }\n    },\n    handleSizeChange(val) {\n      this.pagelistquery.pagesize = val\n      this.getcommentlist()\n    },\n    handleCurrentChange(val) {\n      this.pagelistquery.page = val\n      this.getcommentlist()\n    },\n    async del(id, type) {\n      let data = {\n        id: id,\n        type: type\n      }\n        this.$confirm('确认删除吗?', '提示', {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning'\n          }).then(() => {\n          this.$axios.post(\n          '/admin/admindelete',\n          this.qs.stringify(data)\n        ).then(res => {\n        if (res.data.state.type === 'SUCCESS') {\n          this.$message.success('删除成功')\n          this.getcommentlist()\n        }\n        })\n\n          })\n    },\n    async getcommentlist() {\n      this.loading = true\n      let res = await this.$axios.post(\n        '/admin/getcomment',\n        this.qs.stringify(this.pagelistquery)\n      )\n      if (res.data.state.type === 'SUCCESS') {\n        this.tableData = res.data.data\n        this.pagelistquery.total = res.data.count\n        this.getreply()\n      }\n      this.loading = false\n    }\n  },\n  created() {\n    this.getcommentlist()\n  }\n}\n</script>\n<style scoped>\n.top {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: calc(100% - 35px);\n  padding: 12px 16px;\n  background-color: #fff;\n}\n.comment {\n  position: relative;\n  width: 100%;\n}\n.main {\n  margin-top: 40px;\n  padding: 20px;\n  background-color: #fff;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}